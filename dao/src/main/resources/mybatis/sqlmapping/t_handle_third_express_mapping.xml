<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nilo.dms.dao.SendNextStationDao">

    <!-- 实体bean与数据字段对应关系 -->
    <resultMap id="sendBig" type="com.nilo.dms.dao.dataobject.SendNextStationDO">
        <result property="merchantId" column="merchant_id" javaType="java.lang.Long"
                jdbcType="INTEGER"/>
        <result property="handleNo" column="handle_no" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="third_express_code" column="third_waybill_no" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="third_waybill_no" column="third_waybill_no" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="driver" column="driver" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="network_id" column="network_id" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
        <result property="nextStation" column="next_station" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="handle_time" column="handle_time" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
        <result property="handleBy" column="handle_by" javaType="java.lang.Long"
                jdbcType="INTEGER"/>
        <result property="status" column="status" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
        <result property="remark" column="remark" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="created_time" column="created_time" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
        <result property="updated_time" column="updated_time" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
    </resultMap>

    <!--实体bean与数据字段对应关系-->
    <resultMap id="sendSmall" type="com.nilo.dms.dao.dataobject.SendNextStationDetailDO">
        <result property="merchantId" column="merchant_id" javaType="java.lang.Long"
                jdbcType="INTEGER"/>
        <result property="third_handle_no" column="third_handle_no" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="order_no" column="order_no" javaType="java.lang.String"
                jdbcType="VARCHAR"/>
        <result property="weight" column="weight" javaType="java.lang.Double"
                jdbcType="DOUBLE"/>
        <result property="len" column="length" javaType="java.lang.Double"
                jdbcType="DOUBLE"/>
        <result property="height" column="height" javaType="java.lang.Double"
                jdbcType="DOUBLE"/>
        <result property="width" column="width" javaType="java.lang.Double"
                jdbcType="DOUBLE"/>
        <result property="status" column="status" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
        <result property="created_time" column="created_time" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
        <result property="updated_time" column="updated_time" javaType="java.lang.Integer"
                jdbcType="INTEGER"/>
    </resultMap>
    <!-- 查询装车打包 -->
    <select id="queryBig" resultMap="sendBig" statementType="PREPARED"  parameterType="com.nilo.dms.dao.dataobject.SendNextStationDO">
        SELECT
        *
        FROM
        t_handle_third_express
        WHERE 1
        <if test="ob.status != null">
            and status = #{ob.status}
        </if>
        <if test="ob.handleNo != null and ob.handleNo != '' ">
            and handle_no = #{ob.handleNo}
        </if>
        <if test="ob.third_waybill_no != null and ob.third_waybill_no != '' ">
            and third_waybill_no = #{ob.third_waybill_no}
        </if>
        <if test="ob.third_express_code != null and ob.third_express_code != '' ">
            and third_express_code = #{ob.third_express_code}
        </if>
        <if test="ob.network_id != null and ob.network_id != '' ">
            and network_id = #{ob.network_id}
        </if>
        <if test="ob.driver != null and ob.driver != '' ">
            and driver = #{ob.driver}
        </if>
        order by created_time desc

        limit #{offset} , #{limit}

    </select>

    <!-- 查询装车打包数量 -->
    <select id="queryBigCount" resultType="java.lang.Integer" statementType="PREPARED"  parameterType="com.nilo.dms.dao.dataobject.SendNextStationDO">
        SELECT
        count(*)
        FROM
        t_handle_third_express
        WHERE 1
        <if test="ob.status != null">
            and status = #{ob.status}
        </if>
        <if test="ob.handleNo != null and ob.handleNo != '' ">
            and handle_no = #{ob.handleNo}
        </if>
        <if test="ob.third_waybill_no != null and ob.third_waybill_no != '' ">
            and third_waybill_no = #{ob.third_waybill_no}
        </if>
        <if test="ob.third_express_code != null and ob.third_express_code != '' ">
            and third_express_code = #{ob.third_express_code}
        </if>
        <if test="ob.network_id != null and ob.network_id != '' ">
            and network_id = #{ob.network_id}
        </if>
        <if test="ob.driver != null and ob.driver != '' ">
            and driver = #{ob.driver}
        </if>
    </select>

    <insert id="insertBig" parameterType="com.nilo.dms.dao.dataobject.SendNextStationDO"
            statementType="PREPARED" useGeneratedKeys="true" keyProperty="id">
        INSERT
        INTO t_handle_third_express
        ( merchant_id, handle_no, third_express_code, third_waybill_no, driver, network_id, next_station, handle_time, handle_by, status, remark, created_time, updated_time, version)
        VALUES
        (
        #{merchantId},#{handleNo},#{third_express_code},#{third_waybill_no},#{driver},#{network_id},#{nextStation},#{handle_time},#{handleBy},#{status},#{remark},UNIX_TIMESTAMP(NOW()),UNIX_TIMESTAMP(NOW()),UUID()
        )
    </insert>

    <update id="editBigBy" statementType="PREPARED" parameterType="com.nilo.dms.dao.dataobject.SendNextStationDO">
        update t_handle_third_express
        SET
        status = #{status},
        updated_time=UNIX_TIMESTAMP(NOW()),
        version=UUID()
        <if test="driver != null and driver != ''">
            , driver = ${driver}
        </if>
        <if test="third_express_code != null and third_express_code != ''">
            , third_express_code = ${third_express_code}
        </if>
        <if test="third_waybill_no != null and third_waybill_no != ''">
            , third_waybill_no = ${third_waybill_no}
        </if>
        <if test="network_id != null">
            , network_id = ${network_id}
        </if>

        <if test="remark != null and remark != ''">
            , remark = #{remark}
        </if>
        WHERE
        handle_no = #{handleNo}
    </update>



    <!-- 下面是子包分割线 -->
    <select id="querySmall" resultMap="sendSmall" statementType="PREPARED" parameterType="com.nilo.dms.dao.dataobject.SendNextStationDetailDO">
        SELECT
        *
        FROM
        t_handle_third_express_details
        WHERE 1
        <if test="status != null">
            and status = #{status}
        </if>
        <if test="third_handle_no != null and third_handle_no != '' ">
            and third_handle_no = #{third_handle_no}
        </if>
        order by created_time desc
    </select>

    <insert id="insertSmall" parameterType="com.nilo.dms.dao.dataobject.SendNextStationDetailDO"
            statementType="PREPARED" useGeneratedKeys="true" keyProperty="id">
        INSERT
        INTO
        t_handle_third_express_details
        ( third_handle_no, order_no, weight, length, height, width, status, created_time, updated_time, version )
        VALUES
        (#{third_handle_no},#{order_no},#{weight},#{len},#{height},#{width},#{status},UNIX_TIMESTAMP(NOW()),UNIX_TIMESTAMP(NOW()), UUID())
    </insert>

    <insert id="insertSmalls">
        INSERT
        INTO
        t_handle_third_express_details
        ( third_handle_no, order_no, weight, length, height, width, status, created_time, updated_time, version )
        VALUES
        <foreach collection="list" item="now" separator=",">
            (#{now.third_handle_no},#{now.order_no},#{now.weight},#{now.len},#{now.height},#{now.width},#{now.status},UNIX_TIMESTAMP(NOW()),UNIX_TIMESTAMP(NOW()), UUID())
        </foreach>

    </insert>


    <delete id="deleteSmallByHandleNo" parameterType="com.nilo.dms.dao.dataobject.SendNextStationDetailDO">
        delete FROM t_handle_third_express_details
        WHERE third_handle_no = #{third_handle_no}
    </delete>


</mapper>