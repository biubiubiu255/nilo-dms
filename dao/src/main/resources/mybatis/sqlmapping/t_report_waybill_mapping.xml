<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nilo.dms.dao.ReportWaybillDao">

    <!-- 实体bean与数据字段对应关系 -->
    <resultMap id="waybillMap" type="com.nilo.dms.dao.dataobject.ReportWaybillDO">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="order_no" jdbcType="VARCHAR" property="orderNo" />
        <result column="order_type" jdbcType="VARCHAR" property="orderType" />
        <result column="reference_no" jdbcType="VARCHAR" property="referenceNo" />
        <result column="order_time" jdbcType="BIGINT" property="orderTime" />
        <result column="order_status" jdbcType="INTEGER" property="orderStatus" />
        <result column="order_created_time" jdbcType="INTEGER" property="orderCreatedTime" />
        <result column="first_arrive_time" jdbcType="INTEGER" property="firstArriveTime" />
        <result column="first_arrive_network_id" jdbcType="INTEGER" property="firstArriveNetworkId" />
        <result column="first_arrive_network_name" jdbcType="VARCHAR" property="firstArriveNetworkName" />
        <result column="last_deliver_time" jdbcType="INTEGER" property="lastDeliverTime" />
        <result column="last_deliver_network_id" jdbcType="INTEGER" property="lastDeliverNetworkId" />
        <result column="last_deliver_network_name" jdbcType="VARCHAR" property="lastDeliverNetworkName" />
        <result column="last_deliver_express_code" jdbcType="VARCHAR" property="lastDeliverExpressCode" />
        <result column="sign_time" jdbcType="INTEGER" property="signTime" />
        <result column="sign_handle_by_id" jdbcType="BIGINT" property="signHandleById" />
        <result column="sign_handle_by_name" jdbcType="VARCHAR" property="signHandleByName" />
        <result column="sign_network_id" jdbcType="INTEGER" property="signNetworkId" />
        <result column="sign_network_name" jdbcType="VARCHAR" property="signNetworkName" />
        <result column="created_time" jdbcType="INTEGER" property="createdTime" />
        <result column="sign_outsource_name" jdbcType="VARCHAR" property="signOutsourceName" />
        <result column="sign_outsource_code" jdbcType="VARCHAR" property="signOutsourceCode" />
        <result column="last_deliver_rider_id" jdbcType="BIGINT" property="lastDeliverRiderId" />
        <result column="last_deliver_rider_name" jdbcType="VARCHAR" property="lastDeliverRiderName" />
    </resultMap>

    <sql id="Base_Column_List">
        id, order_no, order_type, reference_no, order_time, order_status, order_created_time,
        first_arrive_time, first_arrive_network_id, first_arrive_network_name, last_deliver_time,
        last_deliver_network_id, last_deliver_network_name, last_deliver_express_code, sign_time, sign_handle_by_id,
        sign_handle_by_name, sign_network_id, sign_network_name, created_time
    </sql>

    <select id="queryWaybillReport" resultMap="waybillMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM
        t_report_waybill
        WHERE 1
        <if test="orderNo !=null and orderNo !='' ">
            and order_no LIKE CONCAT( CONCAT('%',#{orderNo}),'%')
        </if>
        <if test="referenceNo !=null and referenceNo !='' ">
            and reference_no LIKE CONCAT( CONCAT('%',#{referenceNo}),'%')
        </if>
        <if test="firstArriveNetworkId !=null and firstArriveNetworkId !='' ">
            and first_arrive_network_id = #{firstArriveNetworkId}
        </if>
        <if test="lastDeliverNetworkId !=null and lastDeliverNetworkId !='' ">
            and last_deliver_network_id = #{lastDeliverNetworkId}
        </if>
        <if test="lastDeliverExpressCode !=null and lastDeliverExpressCode !='' ">
            and last_deliver_express_code = #{lastDeliverExpressCode}
        </if>
        <if test="signHandleById !=null">
            and sign_handle_by_id = #{signHandleById}
        </if>
        <if test="signHandleByName !=null and signHandleByName !='' ">
            and sign_handle_by_name = #{signHandleByName}
        </if>
        <if test="signNetworkId !=null and signNetworkId !='' ">
            and sign_network_id = #{signNetworkId}
        </if>
        <if test="lastDeliverRiderId !=null">
            and last_deliver_rider_id = #{lastDeliverRiderId}
        </if>
        <if test="signOutsourceCode !=null and signOutsourceCode != ''">
            and sign_outsource_code = #{signOutsourceCode}
        </if>

        <if test="fromCreatedTime !=null ">and created_time >= #{fromCreatedTime}</if>
        <if test="toCreatedTime !=null ">and  <![CDATA[ created_time <= #{toCreatedTime} ]]></if>

        <if test="fromOrderTime !=null ">and order_time >= #{fromOrderTime}</if>
        <if test="toOrderTime !=null ">and  <![CDATA[ order_time <= #{toOrderTime} ]]></if>

        <if test="fromOrderCreatedTime !=null ">and order_created_time >= #{fromOrderCreatedTime}</if>
        <if test="toOrderCreatedTime !=null ">and  <![CDATA[ order_created_time <= #{toOrderCreatedTime} ]]></if>

        <if test="fromFirstArriveTime !=null ">and first_arrive_time >= #{fromFirstArriveTime}</if>
        <if test="toFirstArriveTime !=null ">and  <![CDATA[ first_arrive_time <= #{toFirstArriveTime} ]]></if>

        <if test="fromLastDeliverTime !=null ">and last_deliver_time >= #{fromLastDeliverTime}</if>
        <if test="toLastDeliverTime !=null ">and  <![CDATA[ last_deliver_time <= #{toLastDeliverTime} ]]></if>

        <if test="fromSignTime !=null ">and sign_time >= #{fromSignTime}</if>
        <if test="toSignTime !=null ">and  <![CDATA[ sign_time <= #{toSignTime} ]]></if>
        <if test="orderStatus != null">
            and order_status = #{orderStatus}
        </if>
        <if test="networks!=null and networks.size()>0">
            and (
            (first_arrive_network_id in
            <foreach collection="networks" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
            )
            or
            (last_deliver_network_id in
            <foreach collection="networks" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
            )
            or
            (sign_network_id in
            <foreach collection="networks" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
            )
            )
        </if>
        order by created_time desc
        limit #{offset} , #{limit}
    </select>

    <select id="queryCountBy" resultType="java.lang.Long">
        SELECT
        count(1)
        FROM
        t_report_waybill
        WHERE 1
        <if test="orderNo !=null and orderNo !='' ">
            and order_no LIKE CONCAT( CONCAT('%',#{orderNo}),'%')
        </if>
        <if test="referenceNo !=null and referenceNo !='' ">
            and reference_no LIKE CONCAT( CONCAT('%',#{referenceNo}),'%')
        </if>
        <if test="firstArriveNetworkId !=null and firstArriveNetworkId !='' ">
            and first_arrive_network_id = #{firstArriveNetworkId}
        </if>
        <if test="lastDeliverNetworkId !=null and lastDeliverNetworkId !='' ">
            and last_deliver_network_id = #{lastDeliverNetworkId}
        </if>
        <if test="lastDeliverExpressCode !=null and lastDeliverExpressCode !='' ">
            and last_deliver_express_code = #{lastDeliverExpressCode}
        </if>
        <if test="signHandleById !=null">
            and sign_handle_by_id = #{signHandleById}
        </if>
        <if test="signHandleByName !=null and signHandleByName !='' ">
            and sign_handle_by_name = #{signHandleByName}
        </if>
        <if test="signNetworkId !=null and signNetworkId !='' ">
            and sign_network_id = #{signNetworkId}
        </if>
        <if test="lastDeliverRiderId !=null">
            and last_deliver_rider_id = #{lastDeliverRiderId}
        </if>
        <if test="signOutsourceCode !=null and signOutsourceCode != ''">
            and sign_outsource_code = #{signOutsourceCode}
        </if>
        <if test="fromCreatedTime !=null ">and created_time >= #{fromCreatedTime}</if>
        <if test="toCreatedTime !=null ">and  <![CDATA[ created_time <= #{toCreatedTime} ]]></if>

        <if test="fromOrderTime !=null ">and order_time >= #{fromOrderTime}</if>
        <if test="toOrderTime !=null ">and  <![CDATA[ order_time <= #{toOrderTime} ]]></if>

        <if test="fromOrderCreatedTime !=null ">and order_created_time >= #{fromOrderCreatedTime}</if>
        <if test="toOrderCreatedTime !=null ">and  <![CDATA[ order_created_time <= #{toOrderCreatedTime} ]]></if>

        <if test="fromFirstArriveTime !=null ">and first_arrive_time >= #{fromFirstArriveTime}</if>
        <if test="toFirstArriveTime !=null ">and  <![CDATA[ first_arrive_time <= #{toFirstArriveTime} ]]></if>

        <if test="fromLastDeliverTime !=null ">and last_deliver_time >= #{fromLastDeliverTime}</if>
        <if test="toLastDeliverTime !=null ">and  <![CDATA[ last_deliver_time <= #{toLastDeliverTime} ]]></if>

        <if test="fromSignTime !=null ">and sign_time >= #{fromSignTime}</if>
        <if test="toSignTime !=null ">and  <![CDATA[ sign_time <= #{toSignTime} ]]></if>

        <if test="orderStatus != null">
            and order_status = #{orderStatus}
        </if>
    </select>
</mapper>